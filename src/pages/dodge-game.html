<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border:1px solid #d3d3d3;
    background-color: #f1f1f1;

    position: absolute;
    margin: auto;
    display:block;
    top: 0px;
    bottom: 0px;
    left: 0px;
    right: 0px;
}
</style>
</head>
<body onload="Init()">
<script>

//player
var player;
//enemies
var green;
var pink;

var gameStarted;

function Init() {
    player = new component(50, 50, "red", 10, 120);
    green = new component(100,100, "green", 200,200);
    pink = new component(80,80, "pink", 200,200);
    myGameArea.start();
    allEnemies = [green,pink];
}

function startGame() {
    document.getElementById("startGame").style.display = "none"; // delete start button

    player.isDead = false;

    gameStarted = true;

    green.speedX = 2;
    green.speedY = 2;
    
    pink.speedX = 3;
    pink.speedY = 3;
    
    
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 650;
        this.canvas.height = 400;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.interval = setInterval(updateGameArea, 20);
    },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}

function component(width, height, color, x, y) {
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;
    this.x = x;
    this.y = y;
    
    this.color = color;
    
    this.isDead = false;
    
    
    
    this.update = function() {
        ctx = myGameArea.context;
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
        
        // position of corners.(x,y)
        //             0     1
        this.corner1=[this.x, this.y];
    	//                    0             1
        this.corner2=[this.x + this.width, this.y];
    	//               0             1
        this.corner3=[this.x, this.y + this.height];
    	//                   0                    1
        this.corner4=[this.x + this.width, this.y + this.height];
        
        // text on corners.
        //corner 1.
        ctx.fillText( this.corner1, this.corner1[0]-30 , this.corner1[1] );
        // corner 2
        ctx.fillText( this.corner2, this.corner2[0], this.corner2[1] );
        // corner 3
        ctx.fillText( this.corner3, this.corner3[0]-35, this.corner3[1]+8 );
        // corner 4.
        ctx.fillText( this.corner4, this.corner4[0], this.corner4[1]+8 );
        
        this.allCorners=[this.corner1, this.corner2, this.corner3, this.corner4];
        
        
        if(this.isDead == true)
        {
           this.x = myGameArea.canvas.width/2; 
           this.y = myGameArea.canvas.height/2;        
           this.speedX = 0;
           this.speedY = 0;
        }
        else {
            this.color = color;
        }
        ctx.fillText( this.isDead , this.corner1[0]-100 , this.corner1[1] );

    // square movement#1
    }
    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;        
    }  
    // collision check
    this.numCornersCollide = 0;
    this.checkCollideWithComponent = function(collisionBox) {
        	
        ctx = myGameArea.context;
        ctx.fillStyle = this.color; //sets text to this component color
        ctx.font = "15px Arial";
 
        //check for connection to box (parameter)
        //ctx.fillText(collisionBox.corner1, this.corner3[0] - this.width + 20 , this.corner3[1] + 10);
 
        //how many corners collide?
        this.numCornersCollide = 0;
        //ctx.fillText(numCollideCorners, this.corner3[0] - this.width + 20 , this.corner3[1] + 10);
 
        //for every corner in this.allCorners
        for ( i=0; i < this.allCorners.length; i++)
        {
            corner=this.allCorners[i];
            
            if(corner[0] > collisionBox.corner1[0] && 
               corner[0] < collisionBox.corner2[0]){
            	//check if corner1y between green 
        	   if(corner[1] < collisionBox.corner4[1] && 
                  corner[1] > collisionBox.corner1[1]){
                	this.numCornersCollide ++ ;
            	}
            }	
        }
        if(this.numCornersCollide > 0) {

            this.color = "black";
            this.isDead = true;
            this.speedX = 0;
            this.speedY = 0;
            
        } 
    }
    //check if corners of player collide with wall.
    this.checkCollideWithWall = function(canvas_width , canvas_height , bounceBackSpeed) {
        ctx = myGameArea.context;
        ctx.fillStyle = this.color; //sets text to this component color
        ctx.font = "10px Arial";
        ctx.fillText("speedX : " + this.speedX, this.corner3[0],   this.corner3[1] + 20); //shows x speed
        ctx.fillText("speedY : " + this.speedY, this.corner3[0],   this.corner3[1] + 30); //shows y speed

        for ( i=0; i < this.allCorners.length; i++)
        {
            corner=this.allCorners[i];

            //if corner X < or = 0 which is canvas 0 or the left side...
            if (corner[0] <= 0)
            {
                if(this.speedX < 0) // if the speed is neg...
                {
                    this.speedX = bounceBackSpeed; // bounce back in pos speed.
                }
                    
            }
           
          //if corner X > or = to canvas width or the right side...  
            if(corner[0] >= canvas_width) 
            {
                if(this.speedX > 0)// if this speed is pos...
                {
                    this.speedX = -bounceBackSpeed; // bounce back in neg speed
                }
            } 

        //  if corner Y < or = 0 wich is canvas 0 or the top...
            if(corner[1] <= 0)
            {
                if(this.speedY < 0)// if the speed is neg...
                {
                    this.speedY = bounceBackSpeed;// bounce back in pos speed.
                }
            }
            
          //if corner Y >= canvas height or the bottom...  
            if(corner[1] >= canvas_height)
            {

                if(this.speedY > 0)// if the speed is pos...
                {
                    this.speedY = -bounceBackSpeed;// bounce back in neg speed.
                }

            }
        }
    }
}

function KeyDownListener() {
    window.addEventListener("keydown", function (event) {
        if (event.defaultPrevented) {
            return; // Do nothing if the event was already processed
        }
 
        switch (event.key) {
            case "ArrowDown":
                // code for "down arrow" key press.
                movedown();
            break;
            case "ArrowUp":
                // code for "up arrow" key press.
                moveup();
            break;
            case "ArrowLeft":
                // code for "left arrow" key press.
                moveleft();
            break;
            case "ArrowRight":
                // code for "right arrow" key press.
                moveright();
            break;
            case " ":
                // code for " " key press.
                slowDown();
            break;
            default:
 
            return; // Quit when this doesn't handle the key event.
        }
 
        // Cancel the default action to avoid it being handled twice
        event.preventDefault();
    }, true);
}

function playerDead() {

    player.speedX = 0;
    player.speedY = 0;
    gameStarted = false;

    score = 0;

    document.getElementById("startGame").style.display = "block"; //display start button

    allEnemies.forEach(enemy => {
        enemy.speedX = 0;
        enemy.speedY = 0;
    });
}

function updateGameArea() {
    myGameArea.clear();
    player.update();
    green.update();
    pink.update();


    player.newPos();    
    player.checkCollideWithComponent(green);
    player.checkCollideWithWall(myGameArea.canvas.width , myGameArea.canvas.height , 2);

    green.newPos();
    green.checkCollideWithWall(myGameArea.canvas.width , myGameArea.canvas.height , 2);
    
    pink.newPos();
    pink.checkCollideWithWall(myGameArea.canvas.width , myGameArea.canvas.height , 2)
    
    if(player.isDead) {
        playerDead();
    }
    else {
        KeyDownListener();
    }
    
}

function moveup() {
    player.speedY -= 1; 
}

function movedown() {
    player.speedY += 1; 
}

function moveleft() {
    player.speedX -= 1; 
}

function moveright() {
    player.speedX += 1; 
}

function slowDown() {

    player.speedX = 0;
    player.speedY = 0;
    

}

var score = 0;
var highscore = 0;
setInterval(() => {
   
   if(gameStarted) {
        score += 1;
        if (score > highscore)
        {
            highscore = score;
        }
   }
   
   
   
   document.getElementById("score").innerHTML = score.toString();
   document.getElementById("highscore").innerHTML = highscore.toString();

}, 1000);

</script>
    <!--Buttons-->
    <div style="text-align:center; 
                position: absolute;
                margin: auto;
                display: block;
                top: 570px;
                bottom: 0;
                left: 0;
                right: 0;">
        <button onclick="moveup()">UP</button><br><br>
        <button onclick="moveleft()">LEFT</button>
        <button onclick="moveright()">RIGHT</button><br><br>
        <button onclick="movedown()">DOWN</button>
    </div>
 
    <!--Start Game-->
    <div id="startGame"; style="text-align:center; 
                position: absolute;
                margin: auto;
                display:block;
                top: 450px;
                bottom: 0;
                left: 0px;
                right: 0;
                transform: scale(2)">
        <button onclick="startGame()">StartGame</button>
    </div>
 
    <div; style="position:absolute;
                text-align:center;
                margin: auto;
                display: block;
                top: 650px;
                bottom: 0;
                left: 0;
                right: 0;">
        &nbsp;
        <p>If you click a button the red square will start moving. Click the same button many times, and it will move
            faster and faster.</p>
 
    </div>
 
    <div id="buttonPressed" ; style="position:absolute;
                                    text-align:center;
                                    margin: auto;
                                    display: block;
                                    top: 0;
                                    bottom: 300px;
                                    left: 0;
                                    right: 500px;">
        buttonPressed
    </div>
 
    <div id="test" ; style="position:absolute;
                                text-align:center;
                                margin: auto;
                                display: block;
                                top: 0;
                                bottom: 250px;
                                left: 0;
                                right: 500px;">
        testDIV
    </div>
 
 <h1 id = "score"; style = "position:absolute;
                            text-align: center;  
                            margin: auto;
                            display: block; 
                            top: 0px;
                            bottom: 1110px; 
                            left: 110px;
                            right: 0;">                      
    0
    <h1 style = "position:absolute;
                text-align: center;  
                margin: auto;
                display: block; 
                top: 0px;
                bottom: 1110px; 
                left: 0px;
                right: 0;"> 

        Score:
    </h1>
</h1>
 

<!--HIGHSCORE-->
<h3 id="highscore" ; style="position:absolute;
                            text-align:center;
                            margin: auto;
                            display: block;
                            top: 140px;
                            bottom: 1170px; 
                            left: 620px;
                            right: 0;">                        
    0
        <h3 style="position:absolute;
        text-align:center;
        margin: auto;
        display: block;
        top: 140px;
        bottom: 1170px;
        left: 490px;
        right: 0;">
    Highscore:
    </h3>
</h3>
 
</body>
</html>
